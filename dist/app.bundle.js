!function(t){var s={};function e(i){if(s[i])return s[i].exports;var o=s[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var o in t)e.d(i,o,function(s){return t[s]}.bind(null,o));return i},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=4)}({4:function(t,s,e){"use strict";e.r(s);const i="top",o="bottom",n="left",r="right ",h="PLAY",a="EVENT",d="OVER",c={width:500,height:500,size:20,speed:200,throughWalls:!1,snakeColor:"#a6c529",snakeHeadColor:"#516a05",targetColor:"#aa5d81",sound:!0},l=new Event("updateScore"),p=new Event("gameOver"),u={[h]:new Audio("./assets/sounds/play.mp3"),[a]:new Audio("./assets/sounds/success.mp3"),[d]:new Audio("./assets/sounds/over.mp3")};class g{constructor(t,s={}){t||console.error("ctx is required!"),this.ctx=t,this.options=Object.assign({},c,s),this.isStarted=!1,this.cols=Math.floor(this.options.width/this.options.size),this.rows=Math.floor(this.options.height/this.options.size),this.direction=r,this.setNewGame(),this.draw(),document.addEventListener("keydown",this.setDirection.bind(this))}setNewGame(){this.snake=this.createSnake(),this.target=this.createTarget(),this.isNewGame=!1,this.score=0}createSnake(){return[{x:Math.floor(this.cols/2)*this.options.size,y:Math.floor(this.rows/2)*this.options.size}]}createTarget(){return{x:Math.floor(Math.random()*this.cols)*this.options.size,y:Math.floor(Math.random()*this.rows)*this.options.size}}drawBackground(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++)this.ctx.fillStyle=s%2==t%2?"rgb(0,0,0,0.05)":"rgb(255,255,255,1)",this.ctx.fillRect(s*this.options.size,t*this.options.size,this.options.size,this.options.size)}drawTarget(){this.ctx.fillStyle=this.options.targetColor,this.drawCircle(this.target.x+this.options.size/2,this.target.y+this.options.size/2)}drawSnake(){for(let t=0;t<this.snake.length;t++)this.ctx.fillStyle=0===t?this.options.snakeHeadColor:this.options.snakeColor,this.drawCircle(this.snake[t].x+this.options.size/2,this.snake[t].y+this.options.size/2)}drawCircle(t,s){this.ctx.beginPath(),this.ctx.arc(t,s,this.options.size/2,0,2*Math.PI,!1),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.options.width,this.options.height),this.drawBackground(),this.drawTarget(),this.drawSnake()}updateSnake(){let t=this.snake[0].x,s=this.snake[0].y;switch(this.direction){case n:t-=this.options.size;break;case r:t+=this.options.size;break;case i:s-=this.options.size;break;case o:s+=this.options.size}for(let e=0;e<this.snake.length;e++)if(this.snake[e].x===t&&this.snake[e].y===s)return 1===e?void(this.snake=this.snake.reverse()):void this.end();const e=this.isOutOfZone(t,s);if(e.x!==t||e.y!==s){if(!this.options.throughWalls)return this.end();t=e.x,s=e.y}t===this.target.x&&s===this.target.y?(this.target=this.createTarget(),this.score++,this.soundPlay(a),document.dispatchEvent(l)):this.snake.pop(),this.snake.unshift({x:t,y:s})}isOutOfZone(t,s){return t>=this.options.width?t=0:t<0&&(t=this.options.width-this.options.size),s>=this.options.height?s=0:s<0&&(s=this.options.height-this.options.size),{x:t,y:s}}setDirection(t){return"ArrowUp"===t.code&&this.direction!==o?this.direction=i:"ArrowDown"===t.code&&this.direction!==i?this.direction=o:"ArrowRight"===t.code&&this.direction!==n?this.direction=r:"ArrowLeft"===t.code&&this.direction!==r?this.direction=n:void 0}start(){this.isNewGame&&(this.setNewGame(),document.dispatchEvent(l)),this.stop(),this.timer=setInterval(()=>{this.updateSnake(),this.draw()},this.options.speed),this.isStarted=!0,this.soundPlay(h)}stop(){clearInterval(this.timer),this.timer=null,this.isStarted=!1}end(){this.stop(),this.isNewGame=!0,this.isStarted=!1,this.soundPlay(d),document.dispatchEvent(p)}soundPlay(t){this.options.sound&&u[t]&&u[t].play()}}const f=document;new class{constructor(t){const s=f.getElementById("snake").getContext("2d");this.score=f.getElementById("score"),this.over=f.querySelector(".game-over"),this.snake=new g(s),this.toggleBtn=f.getElementById("start"),this.soundBtn=f.getElementById("sound-btn"),this.setScore(),f.addEventListener("updateScore",this.setScore.bind(this)),f.addEventListener("gameOver",this.showOver.bind(this)),this.toggleBtn.addEventListener("click",this.toggleGame.bind(this)),this.soundBtn.addEventListener("click",this.toggleSound.bind(this)),f.getElementById("setting-btn").addEventListener("click",this.showPopup.bind(this)),f.querySelector(".popup__close").addEventListener("click",this.hidePopup.bind(this))}setScore(){console.log("setScoreThis",this),this.score.innerHTML=this.snake.score}showOver(){this.over.classList.add("game-over_active"),this.toggleBtn.innerHTML="Старт"}toggleGame(){this.snake.isStarted?(this.snake.stop(),this.toggleBtn.innerHTML="Продолжить"):(this.over.classList.remove("game-over_active"),this.snake.start(),this.toggleBtn.innerHTML="Пауза")}showPopup(){f.querySelector(".popup").classList.add("popup__active")}hidePopup(){f.querySelector(".popup").classList.remove("popup__active")}toggleSound(){this.soundBtn.classList.toggle("btn_stroke"),this.snake.options.sound=!this.snake.options.sound}}}});