(()=>{"use strict";const t="top",s="bottom",e="left",i="right ",o={width:500,height:500,size:20,speed:200,throughWalls:!1,snakeColor:"#a6c529",snakeHeadColor:"#516a05",targetColor:"#aa5d81"},h=new Event("updateScore"),n=new Event("gameOver"),r=new Audio("./assets/sounds/play.mp3"),a=new Audio("./assets/sounds/success.mp3"),c=new Audio("./assets/sounds/over.mp3"),d=document.getElementById("snake"),l=document.getElementById("score"),p=document.querySelector(".game-over"),u=d.getContext("2d"),g=new class{constructor(t,s={}){t||console.error("ctx is required!"),this.ctx=t,this.options=Object.assign({},o,s),this.cols=Math.floor(this.options.width/this.options.size),this.rows=Math.floor(this.options.height/this.options.size),this.direction=i,this.setNewGame(),this.draw(),document.addEventListener("keydown",this.setDirection.bind(this))}setNewGame(){this.snake=this.createSnake(),this.target=this.createTarget(),this.isNewGame=!1,this.score=0}createSnake(){return[{x:Math.floor(this.cols/2)*this.options.size,y:Math.floor(this.rows/2)*this.options.size}]}createTarget(){return{x:Math.floor(Math.random()*this.cols)*this.options.size,y:Math.floor(Math.random()*this.rows)*this.options.size}}drawBackground(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++)this.ctx.fillStyle=s%2==t%2?"rgb(0,0,0,0.05)":"rgb(255,255,255,1)",this.ctx.fillRect(s*this.options.size,t*this.options.size,this.options.size,this.options.size)}drawTarget(){this.ctx.fillStyle=this.options.targetColor,this.drawCircle(this.target.x+this.options.size/2,this.target.y+this.options.size/2)}drawSnake(){for(let t=0;t<this.snake.length;t++)this.ctx.fillStyle=0===t?this.options.snakeHeadColor:this.options.snakeColor,this.drawCircle(this.snake[t].x+this.options.size/2,this.snake[t].y+this.options.size/2)}drawCircle(t,s){this.ctx.beginPath(),this.ctx.arc(t,s,this.options.size/2,0,2*Math.PI,!1),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.options.width,this.options.height),this.drawBackground(),this.drawTarget(),this.drawSnake()}updateSnake(){let o=this.snake[0].x,n=this.snake[0].y;switch(this.direction){case e:o-=this.options.size;break;case i:o+=this.options.size;break;case t:n-=this.options.size;break;case s:n+=this.options.size}for(let t=0;t<this.snake.length;t++)if(this.snake[t].x===o&&this.snake[t].y===n)return 1===t?void(this.snake=this.snake.reverse()):void this.end();const r=this.isOutOfZone(o,n);if(r.x!==o||r.y!==n){if(!this.options.throughWalls)return this.end();o=r.x,n=r.y}o===this.target.x&&n===this.target.y?(this.target=this.createTarget(),this.score++,a.play(),document.dispatchEvent(h)):this.snake.pop(),this.snake.unshift({x:o,y:n})}isOutOfZone(t,s){return t>=this.options.width?t=0:t<0&&(t=this.options.width-this.options.size),s>=this.options.height?s=0:s<0&&(s=this.options.height-this.options.size),{x:t,y:s}}setDirection(o){return"ArrowUp"===o.code&&this.direction!==s?this.direction=t:"ArrowDown"===o.code&&this.direction!==t?this.direction=s:"ArrowRight"===o.code&&this.direction!==e?this.direction=i:"ArrowLeft"===o.code&&this.direction!==i?this.direction=e:void 0}start(){this.isNewGame&&(this.setNewGame(),document.dispatchEvent(h)),this.stop(),this.timer=setInterval((()=>{this.updateSnake(),this.draw()}),this.options.speed),r.play()}stop(){clearInterval(this.timer),this.timer=null}end(){this.stop(),this.isNewGame=!0,c.play(),document.dispatchEvent(n)}}(u);l.innerHTML=g.score,document.addEventListener("updateScore",(()=>{l.innerHTML=g.score})),document.addEventListener("gameOver",(()=>{p.classList.add("game-over_active")})),document.getElementById("start").addEventListener("click",(()=>{p.classList.remove("game-over_active"),g.start()})),document.getElementById("pause").addEventListener("click",(()=>{g.stop()}))})();